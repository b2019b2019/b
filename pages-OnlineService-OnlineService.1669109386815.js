(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-OnlineService-OnlineService"],{"1a42":function(e,t,n){"use strict";n.r(t);var i=n("feed"),a=n.n(i);for(var o in i)"default"!==o&&function(e){n.d(t,e,(function(){return i[e]}))}(o);t["default"]=a.a},"1ac5":function(e,t,n){var i=n("24fb");t=i(!1),t.push([e.i,"uni-page-body[data-v-7b1f091d]{background:#eaf7ff}uni-image[data-v-7b1f091d]{width:100%;height:100%}.navigationBar[data-v-7b1f091d]{background:#fff;padding:%?20?%;color:#000;text-align:center;display:flex;\r\n    /* justify-content: space-between; */position:fixed;width:95%;z-index:999}.navigationBarImg[data-v-7b1f091d]{width:14%;text-align:left;display:flex}.navigationBar uni-text[data-v-7b1f091d]{display:inline-block;width:72%;font-size:%?30?%}.onlineBox[data-v-7b1f091d]{display:flex;align-items:center}.onlineBox uni-image[data-v-7b1f091d]{width:%?22?%;height:%?22?%;margin-left:%?8?%}.btnBox[data-v-7b1f091d]{display:flex;padding:%?20?% 0 %?68?%;background:#fff;position:fixed;width:100%;bottom:0}.btnBox uni-input[data-v-7b1f091d]{border:%?4?% solid;border-radius:%?18?%;background:#fff;height:%?58?%;width:51%}.btnBoxAdd[data-v-7b1f091d]{background:#4da54d;color:#fff;display:flex;justify-content:center;align-items:center;height:%?66?%;width:%?106?%;border-radius:%?60?%;font-size:%?44?%}.btnBoxSend[data-v-7b1f091d]{background:#4da54d;color:#fff;display:flex;align-items:center;justify-content:center;width:%?146?%;font-size:%?32?%;border-radius:%?60?%;height:%?66?%}.chat-item[data-v-7b1f091d]{display:flex;padding:%?20?%;font-size:%?30?%;align-items:flex-start;justify-content:flex-start}.chat-userAvatar[data-v-7b1f091d]{width:%?80?%;height:%?80?%}.chat-userAvatar uni-image[data-v-7b1f091d]{border-radius:50%}.chat-presentOne[data-v-7b1f091d]{width:calc(100% - %?80?%);margin-left:%?10?%}.xiaoxiName[data-v-7b1f091d]{display:flex;align-items:flex-start;flex-direction:column}.xiaoxiName uni-view[data-v-7b1f091d]{background:#fff;border-radius:%?20?%;padding:%?20?% %?10?%;word-wrap:break-word;word-break:break-all;text-align:left;margin-left:%?10?%}.xiaoxiName-main[data-v-7b1f091d]{background-color:#eee!important;display:flex;align-items:center}.item[data-v-7b1f091d]{display:flex;align-items:flex-start;width:100%}.chat-presentOne-img[data-v-7b1f091d]{width:calc(100% - %?160?%);display:flex;justify-content:flex-start;margin-left:%?22?%\r\n\t/* margin-left: 10rpx; */}.chat-presentOne-img uni-image[data-v-7b1f091d]{width:%?200?%;height:%?300?%;border-radius:%?10?%;width:100%}.chat-presentOne-img2[data-v-7b1f091d]{width:calc(100% - %?160?%);display:flex;justify-content:flex-end;margin-right:%?22?%}.chat-presentOne-img2 uni-image[data-v-7b1f091d]{width:%?200?%;height:%?300?%;border-radius:%?10?%;width:100%}.item2[data-v-7b1f091d]{display:flex;align-items:flex-start;width:100%;justify-content:flex-end}body.?%PAGE?%[data-v-7b1f091d]{background:#eaf7ff}",""]),e.exports=t},"5fb7":function(e,t,n){var i=n("1ac5");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var a=n("4f06").default;a("16f327ee",i,!0,{sourceMap:!1,shadowMode:!1})},"6c49":function(e,t,n){"use strict";var i;n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return i}));var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",{},[n("v-uni-view",{staticClass:"navigationBar"},[n("v-uni-view",{staticClass:"navigationBarImg"},[n("v-uni-image",{staticStyle:{width:"30upx",height:"30upx"},attrs:{src:"/static/jiantouzuo.png",mode:""},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.back.apply(void 0,arguments)}}})],1),n("v-uni-text",[e._v(e._s(e.pageTitle+"客服"))]),n("v-uni-view",{staticClass:"onlineBox"})],1),n("v-uni-text",{staticStyle:{color:"#759FEF","font-size":"20rpx",width:"100%","text-align":"center",display:"inline-block","padding-top":"110rpx"}},[e._v(e._s(e.hint))]),n("v-uni-view",{staticClass:"chat"},e._l(e.comentList,(function(t,i){return n("v-uni-view",{key:i,staticClass:"chat-item",style:e.userInfo.id==t.sendid?{justifyContent:"flex-end"}:""},[e.userInfo.id!=t.sendid?n("v-uni-view",{staticClass:"item"},[n("v-uni-view",{staticClass:"chat-userAvatar"},[n("v-uni-image",{attrs:{src:t.photo?e.Api+t.photo:e.Api+t.sendphoto,mode:""}})],1),"1"===t.img?n("v-uni-view",{staticClass:"chat-presentOne-img"},[n("v-uni-image",{attrs:{src:e.Api+t.content.substring(1),mode:"heightFix"},on:{click:function(n){arguments[0]=n=e.$handleEvent(n),e.imgClick(e.Api+t.content.substring(1))}}})],1):n("v-uni-view",{staticClass:"chat-presentOne"},[n("v-uni-view",{staticClass:"xiaoxiName"},[n("v-uni-view",{domProps:{innerHTML:e._s(t.content)},on:{click:function(n){arguments[0]=n=e.$handleEvent(n),e.copyText(t.content)}}})],1)],1)],1):n("v-uni-view",{staticClass:"item2",staticStyle:{"text-align":"-webkit-right"}},["1"===t.img?n("v-uni-view",{staticClass:"chat-presentOne-img2"},[n("v-uni-image",{attrs:{src:e.Api+t.content.substring(1),mode:"heightFix"},on:{click:function(n){arguments[0]=n=e.$handleEvent(n),e.imgClick(e.Api+t.content.substring(1))}}})],1):n("v-uni-view",{staticClass:"chat-presentOne",staticStyle:{"margin-right":"20rpx"}},[n("v-uni-view",{staticClass:"xiaoxiName"},[n("v-uni-view",{domProps:{innerHTML:e._s(t.content)},on:{click:function(n){arguments[0]=n=e.$handleEvent(n),e.copyText(t.content)}}})],1)],1),n("v-uni-view",{staticClass:"chat-userAvatar"},[n("v-uni-image",{attrs:{src:t.photo?e.Api+t.photo:e.Api+t.sendphoto,mode:""}})],1)],1)],1)})),1),n("v-uni-view",{staticStyle:{height:"154rpx"}}),n("v-uni-view",{staticClass:"btnBox"},[n("v-uni-button",{staticClass:"btnBoxAdd",attrs:{type:"default"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.chooseImg.apply(void 0,arguments)}}},[e._v("+")]),n("v-uni-input",{attrs:{type:"text",focus:e.trigger()},on:{confirm:function(t){arguments[0]=t=e.$handleEvent(t),e.sendBtn()}},model:{value:e.inputVal,callback:function(t){e.inputVal=t},expression:"inputVal"}}),n("v-uni-button",{staticClass:"btnBoxSend",attrs:{type:"default"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.sendBtn()}}},[e._v("发送")])],1)],1)},o=[]},"8df9":function(e,t,n){"use strict";var i=n("5fb7"),a=n.n(i);a.a},b0f8:function(e,t,n){"use strict";n.r(t);var i=n("6c49"),a=n("1a42");for(var o in a)"default"!==o&&function(e){n.d(t,e,(function(){return a[e]}))}(o);n("8df9");var r,c=n("f0c5"),s=Object(c["a"])(a["default"],i["b"],i["c"],!1,null,"7b1f091d",null,!1,i["a"],r);t["default"]=s.exports},caf3:function(e,t,n){"use strict";function i(e){return new Promise((function(t,n){var i=document.createElement("textarea");i.value=e,i.readOnly="readOnly",document.body.appendChild(i),i.select(),i.setSelectionRange(0,e.length),document.execCommand("copy"),i.remove(),t(e)}))}function a(){return new Promise((function(e,t){navigator.clipboard.readText().then(e).catch(t)}))}n("d3b7"),Object.defineProperty(t,"__esModule",{value:!0}),t.setClipboardData=i,t.getClipboardData=a},d461:function(e,t,n){"use strict";function i(e){if(0===e.indexOf("_www")||0===e.indexOf("_doc")||0===e.indexOf("_documents")||0===e.indexOf("_downloads"))return e;if(0===e.indexOf("file://"))return e;if(0===e.indexOf("/storage/emulated/0/"))return e;if(0===e.indexOf("/")){var t=plus.io.convertAbsoluteFileSystem(e);if(t!==e)return t;e=e.substr(1)}return"_www/"+e}function a(e){var t=e.split(",");return t[t.length-1]}n("c975"),n("ace4"),n("d3b7"),n("ac1f"),n("3ca3"),n("466d"),n("1276"),n("5cc6"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("2954"),n("649e"),n("219c"),n("b39a"),n("72f7"),n("ddb0"),n("2b3d"),Object.defineProperty(t,"__esModule",{value:!0}),t.pathToBase64=s,t.base64ToPath=u;var o=0;function r(){return Date.now()+String(o++)}function c(e,t){for(var n=e.split("."),i=t.split("."),a=!1,o=0;o<i.length;o++){var r=n[o]-i[o];if(0!==r){a=r>0;break}}return a}function s(e){return new Promise((function(t,n){if("object"===typeof window&&"document"in window){if("function"===typeof FileReader){var a=new XMLHttpRequest;return a.open("GET",e,!0),a.responseType="blob",a.onload=function(){if(200===this.status){var e=new FileReader;e.onload=function(e){t(e.target.result)},e.onerror=n,e.readAsDataURL(this.response)}},a.onerror=n,void a.send()}var o=document.createElement("canvas"),r=o.getContext("2d"),c=new Image;return c.onload=function(){o.width=c.width,o.height=c.height,r.drawImage(c,0,0),t(o.toDataURL()),o.height=o.width=0},c.onerror=n,void(c.src=e)}"object"!==typeof plus?"object"===typeof wx&&wx.canIUse("getFileSystemManager")?wx.getFileSystemManager().readFile({filePath:e,encoding:"base64",success:function(e){t("data:image/png;base64,"+e.data)},fail:function(e){n(e)}}):n(new Error("not support")):plus.io.resolveLocalFileSystemURL(i(e),(function(e){e.file((function(e){var i=new plus.io.FileReader;i.onload=function(e){t(e.target.result)},i.onerror=function(e){n(e)},i.readAsDataURL(e)}),(function(e){n(e)}))}),(function(e){n(e)}))}))}function u(e){return new Promise((function(t,n){if("object"===typeof window&&"document"in window){e=e.split(",");var i=e[0].match(/:(.*?);/)[1],o=atob(e[1]),s=o.length,u=new Uint8Array(s);while(s--)u[s]=o.charCodeAt(s);return t((window.URL||window.webkitURL).createObjectURL(new Blob([u],{type:i})))}var d=e.split(",")[0].match(/data\:\S+\/(\S+);/);d?d=d[1]:n(new Error("base64 error"));var l=r()+"."+d;if("object"!==typeof plus)if("object"===typeof wx&&wx.canIUse("getFileSystemManager")){p=wx.env.USER_DATA_PATH+"/"+l;wx.getFileSystemManager().writeFile({filePath:p,data:a(e),encoding:"base64",success:function(){t(p)},fail:function(e){n(e)}})}else n(new Error("not support"));else{var f="_doc",g="uniapp_temp",p=f+"/"+g+"/"+l;if(!c("Android"===plus.os.name?"1.9.9.80627":"1.9.9.80472",plus.runtime.innerVersion))return void plus.io.resolveLocalFileSystemURL(f,(function(i){i.getDirectory(g,{create:!0,exclusive:!1},(function(i){i.getFile(l,{create:!0,exclusive:!1},(function(i){i.createWriter((function(i){i.onwrite=function(){t(p)},i.onerror=n,i.seek(0),i.writeAsBinary(a(e))}),n)}),n)}),n)}),n);var v=new plus.nativeObj.Bitmap(l);v.loadBase64Data(e,(function(){v.save(p,{},(function(){v.clear(),t(p)}),(function(e){v.clear(),n(e)}))}),(function(e){v.clear(),n(e)}))}}))}},feed:function(e,t,n){"use strict";var i=n("4ea4");n("99af"),n("d3b7"),n("ac1f"),n("3ca3"),n("5319"),n("ddb0"),n("2b3d"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n("96cf");var a=i(n("1da1")),o=i(n("c234")),r=n("caf3"),c=n("d461"),s={data:function(){return{pageTitle:"",userInfo:"",comentList:[],interval:"",inputVal:"",Api:o.default.avatarApi,hint:"",getResFlag:!0}},onShow:function(){this.implement()},onLoad:function(){this.getUser()},onHide:function(){uni.closeSocket({})},onUnload:function(){this.getResFlag=!0,uni.closeSocket({})},methods:{copyText:function(e){(0,r.setClipboardData)(e).then((function(e){uni.showToast({title:"复制成功",icon:"success"})}))},imgClick:function(e){this.getResFlag=!1;var t=[];t.push(e),uni.previewImage({current:0,urls:t,success:function(e){},fail:function(e){}})},getPageTitle:function(){var e=this;o.default.apiCall(o.default.baseUrl+"title","get").then((function(t){e.pageTitle=t.data.data}))},implement:function(){this.getPageTitle(),this.connect()},getUser:function(){var e=uni.getStorageSync("userinfo");this.userInfo=e},connect:function(){var e=this;uni.showLoading({title:"加载中..."}),uni.connectSocket({url:"ws://".concat(o.default.wsUrl,":23426")}),uni.onSocketOpen((function(t){var n=e.userInfo.nickname,i=e.userInfo.id,a={action_type:"login",uid:i,username:n,photo:e.userInfo.headimgurl},o=JSON.stringify(a);uni.sendSocketMessage({data:o,fail:function(e){}})})),uni.onSocketError((function(e){})),uni.onSocketMessage((function(t){var n=JSON.parse(t.data);switch(n.action_type){case"new_user_login":console.log(" 登录 更新用户列表"),e.hint=n.content;break;case"new_msg":e.comentList=e.comentList.concat(n);break;case"allmessage":var i=n.data;e.comentList=i,e.$nextTick((function(){uni.createSelectorQuery().select(".chat").boundingClientRect((function(e){var t=e.height;uni.pageScrollTo({duration:100,scrollTop:t+1e3}),uni.hideLoading()})).exec()}));break;case"online_user_count":break;case"image":n.img="1",e.comentList=e.comentList.concat(n);break}}))},sendBtn:function(){var e=this;if(!e.inputVal)return uni.showToast({title:"您不能输入空值哦!",icon:"none"}),!1;var t=e.userInfo.id,n=e.userInfo.nickname,i=e.inputVal,a=e.userInfo.headimgurl,o='{"action_type":"send_msg" , "sendid":"'+t+'" , "toid":"0000" , "username":"'+n+'","photo":"'+a+'","content":"'+i.replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r")+'"}';uni.sendSocketMessage({data:o}),e.inputVal=""},back:function(){uni.navigateBack({delta:1})},uploadOnePictrue:function(e,t){var n=this;return(0,a.default)(regeneratorRuntime.mark((function i(){var a,r;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return a=n,i.next=3,n.compress(e,t);case 3:r=i.sent,(0,c.pathToBase64)(r).then((function(e){o.default.apiCall(o.default.baseUrl+"saveimg","POST",{sendid:a.userInfo.id,toid:"0000",photo:a.userInfo.headimgurl,username:a.userInfo.nickname,cardzbase:e}).then((function(e){var t={action_type:"img",sendid:a.userInfo.id,toid:"0000",username:a.userInfo.nickname,photo:a.userInfo.headimgurl,img_id:e.data.msg},n=JSON.stringify(t);uni.sendSocketMessage({data:n}),uni.hideLoading()}))})).catch((function(e){console.error(e)}));case 5:case"end":return i.stop()}}),i)})))()},chooseImg:function(){var e=this;uni.chooseImage({count:1,sizeType:"original",success:function(t){e.uploadOnePictrue(t.tempFilePaths[0],t.tempFiles[0])}})},compress:function(e,t){return uni.showLoading({title:"发送中"}),new Promise((function(n){uni.getImageInfo({src:e,success:function(i){if(t.size>50480){var a=i.width,o=i.height,r=new Image;r.src=i.path;var c=document.createElement("canvas"),s=c.getContext("2d");c.width=a/3,c.height=o/3,s.drawImage(r,0,0,a/3,o/3),c.toBlob((function(e){var t=window.URL.createObjectURL(e);n(t)}))}else n(e)}})}))},trigger:function(){this.interval=setInterval((function(){}),500)},outOfFocus:function(){clearInterval(this.interval)},scrollToEnd:function(){document.body.scrollTop=document.body.scrollHeight}}};t.default=s}}]);